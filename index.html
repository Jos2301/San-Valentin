<!DOCTYPE html>
<html>
<head>
  <title>A-Frame Image Target Example</title>
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
</head>
<body>
  <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
    <a-marker type="pattern" url="IMG/San_Valentin.png" emitevents="markerFound, markerLost" marker-handler>
      <a-entity position="0 0 0" scale="0.5 0.5 0.5" visible="false">
        <a-gltf-model src="MODELS/Flores.fbx"></a-gltf-model>
        <a-animation attribute="position" dur="2000" to="0 0.2 0" direction="alternate" easing="ease-in-out" repeat="indefinite"></a-animation>
        <a-animation attribute="rotation" dur="5000" to="0 360 0" easing="linear" repeat="indefinite"></a-animation>
      </a-entity>

      <a-text value="Te amo" position="0 1 0" scale="1 1 1" color="#FF00FF" visible="false" font="Roboto, 40px, normal">
        <a-animation attribute="scale" dur="1000" to="1.1 1.1 1.1" direction="alternate" easing="ease-in-out" repeat="indefinite"></a-animation>
      </a-text>
    </a-marker>

    <a-entity id="particle-emitter" position="0 0 0">
      <a-particle-system 
        preset="default"
        color="pink"
        particleCount="50"
        duration="1000" 
        direction="0 -1 0" 
        maxParticleSpeed="1"
        src="#heart-particle"
      >
      </a-particle-system>
    </a-entity>

    <img id="heart-particle" src="assets/heart.png" style="display: none;">

    <audio id="mySong" src="assets/my_song.mp3" preload="auto"></audio>

    <a-camera></a-camera>
  </a-scene>

  <script>
    AFRAME.registerComponent('marker-handler', {
      init: function () {
        this.el.addEventListener('markerFound', () => {
          this.el.querySelector('a-entity').setAttribute('visible', true);
          document.querySelector('#particle-emitter').setAttribute('particle-system', 'emitting', true);
          this.el.querySelector('a-text').setAttribute('visible', true);
          document.querySelector('#mySong').play();
        });
        this.el.addEventListener('markerLost', () => {
          this.el.querySelector('a-entity').setAttribute('visible', false);
          document.querySelector('#particle-emitter').setAttribute('particle-system', 'emitting', false);
          this.el.querySelector('a-text').setAttribute('visible', false);
          document.querySelector('#mySong').pause();
        });
      }
    });
  </script>
</body>
</html>